<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AdSimulator â€” Demo Ads</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <body>
    <header class="hero">
      <div class="hero-inner">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
        <h1>AdSimulator</h1>
        <p class="tagline">A small demo ad-serving stack â€” browse ads, test click tracking, and iterate on bidding algorithms.</p>
        <div class="features">
          <div class="feature">â€¢ Bid Engine (ASP.NET)</div>
          <div class="feature">â€¢ Redis cache & Postgres persistence</div>
          <div class="feature">â€¢ A/B testing & pluggable strategies</div>
          <div class="feature">â€¢ Frontend demo with click proxy</div>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="intro">
        <h2>Featured Ads</h2>
        <p>Below are up to two ads selected by the bid engine for you (user <code><%= userId %></code>).</p>
      </section>

      <% if (ads.length === 0) { %>
        <div class="no-ads">No ads returned for the current placement.</div>
      <% } else { %>
        <section class="ads-grid">
          <% ads.forEach(function(ad) { %>
            <article class="ad-card">
              <div class="ad-media">
                <img src="<%= ad.adContent?.imageUrl %>" alt="<%= ad.adContent?.title %>" />
              </div>
              <div class="ad-body">
                <h3><%= ad.adContent?.title || 'Sponsored' %></h3>
                <p class="ad-desc"><%= ad.adContent?.description || '' %></p>
                <div class="ad-meta">
                  <span class="bid">Bid: <strong><%= ad.bidPrice %></strong></span>
                  <a class="cta" href="/click?redirect=<%= encodeURIComponent(ad.adContent?.redirectUrl) %>&campaignId=<%= ad.campaignId %>&adId=<%= ad.adId %>&userId=<%= userId %>">Open Ad</a>
                </div>
              </div>
            </article>
          <% }) %>
        </section>
      <% } %>

      <section class="about">
        <h2>About this demo</h2>
        <p>This project demonstrates a simple ad auction flow, campaign management, and click tracking with Prometheus metrics. It's a good starting point if you want to experiment with different bidding strategies or add features such as rate-limiting, fraud detection, or richer analytics.</p>
      </section>
    </main>

    <footer class="footer">
      <small>AdSimulator â€” Local demo â€¢ <a href="/">Refresh</a></small>
    </footer>
    <script>
      (function(){
        const toggle = document.getElementById('theme-toggle');
        const body = document.body;
        const storageKey = 'theme';
        function applyTheme(theme){
          if(theme === 'light'){
            body.setAttribute('data-theme','light');
            toggle.textContent = 'ðŸŒž';
          } else {
            body.removeAttribute('data-theme');
            toggle.textContent = 'ðŸŒ™';
          }
        }
        let theme = localStorage.getItem(storageKey);
        if(!theme){
          const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
          theme = prefersLight ? 'light' : 'dark';
        }
        applyTheme(theme);
        toggle.addEventListener('click', function(){
          theme = theme === 'light' ? 'dark' : 'light';
          localStorage.setItem(storageKey, theme);
          applyTheme(theme);
        });
      })();
    </script>
  </body>
</html>
